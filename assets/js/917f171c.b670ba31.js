"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[58],{9865:(n,i,t)=>{t.r(i),t.d(i,{assets:()=>c,contentTitle:()=>p,default:()=>a,frontMatter:()=>l,metadata:()=>e,toc:()=>o});const e=JSON.parse('{"id":"develop/porting","title":"\u79fb\u690d\u5230\u5176\u4ed6\u5e73\u53f0","description":"image","source":"@site/docs/develop/porting.md","sourceDirName":"develop","slug":"/develop/porting","permalink":"/RPi_DM_YT350S006/docs/develop/porting","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/develop/porting.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4},"sidebar":"tutorialSidebar","previous":{"title":"\u9002\u914d\u65b0\u5c4f\u5e55","permalink":"/RPi_DM_YT350S006/docs/develop/adapt"},"next":{"title":"DRM\u5f00\u53d1","permalink":"/RPi_DM_YT350S006/docs/develop/drm"}}');var r=t(4848),s=t(8453);const l={sidebar_position:4},p="\u79fb\u690d\u5230\u5176\u4ed6\u5e73\u53f0",c={},o=[{value:"\u5feb\u901f\u90e8\u7f72\u793a\u4f8b",id:"\u5feb\u901f\u90e8\u7f72\u793a\u4f8b",level:2},{value:"\u5f00\u673a\u81ea\u52a8\u52a0\u8f7d",id:"\u5f00\u673a\u81ea\u52a8\u52a0\u8f7d",level:3},{value:"\u79fb\u690d\u8fc7\u7a0b",id:"\u79fb\u690d\u8fc7\u7a0b",level:2},{value:"\u5982\u4f55\u7f16\u5199\u5e76\u5e94\u7528\u4e00\u4e2a DT overlay \u6587\u4ef6",id:"\u5982\u4f55\u7f16\u5199\u5e76\u5e94\u7528\u4e00\u4e2a-dt-overlay-\u6587\u4ef6",level:3},{value:"\u5982\u4f55\u4f7f\u7528 panel-mipi-dbi \u9a71\u52a8",id:"\u5982\u4f55\u4f7f\u7528-panel-mipi-dbi-\u9a71\u52a8",level:3},{value:"\u5c4f\u5e55\u7684\u80cc\u5149\u662f\u4e2a\u5927\u95ee\u9898",id:"\u5c4f\u5e55\u7684\u80cc\u5149\u662f\u4e2a\u5927\u95ee\u9898",level:3},{value:"1. \u7cfb\u7edf\u4e2d\u7f3a\u5c11 gpio-backlight \u9a71\u52a8\u7684 ko \u6587\u4ef6",id:"1-\u7cfb\u7edf\u4e2d\u7f3a\u5c11-gpio-backlight-\u9a71\u52a8\u7684-ko-\u6587\u4ef6",level:4},{value:"2. \u7cfb\u7edf\u4e2d\u6709 pwm-backlight \u9a71\u52a8\uff0c\u4f46\u662f PD14 \u5f15\u811a\u6ca1\u6709 PWM \u529f\u80fd",id:"2-\u7cfb\u7edf\u4e2d\u6709-pwm-backlight-\u9a71\u52a8\u4f46\u662f-pd14-\u5f15\u811a\u6ca1\u6709-pwm-\u529f\u80fd",level:4},{value:"3. gpio-hog \u914d\u7f6e\u53ef\u4ee5\u8ba9\u67d0\u4e2a\u6307\u5b9a\u5f15\u811a\u5728 gpiochip \u52a0\u8f7d\u65f6\u8bbe\u7f6e\u4e00\u4e2a\u56fa\u5b9a\u72b6\u6001",id:"3-gpio-hog-\u914d\u7f6e\u53ef\u4ee5\u8ba9\u67d0\u4e2a\u6307\u5b9a\u5f15\u811a\u5728-gpiochip-\u52a0\u8f7d\u65f6\u8bbe\u7f6e\u4e00\u4e2a\u56fa\u5b9a\u72b6\u6001",level:4},{value:"4. \u53d6\u5de7\u7684\u65b9\u6cd5\uff0c\u901a\u8fc7 gpio-leds \u9a71\u52a8\u70b9\u4eae\u80cc\u5149",id:"4-\u53d6\u5de7\u7684\u65b9\u6cd5\u901a\u8fc7-gpio-leds-\u9a71\u52a8\u70b9\u4eae\u80cc\u5149",level:4},{value:"\u8ba9\u89e6\u6478\u5c4f\u5de5\u4f5c\u8d77\u6765",id:"\u8ba9\u89e6\u6478\u5c4f\u5de5\u4f5c\u8d77\u6765",level:3},{value:"\u53c2\u8003\u8d44\u6599",id:"\u53c2\u8003\u8d44\u6599",level:2}];function d(n){const i={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",img:"img",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,s.R)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.header,{children:(0,r.jsx)(i.h1,{id:"\u79fb\u690d\u5230\u5176\u4ed6\u5e73\u53f0",children:"\u79fb\u690d\u5230\u5176\u4ed6\u5e73\u53f0"})}),"\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.img,{alt:"image",src:t(7578).A+"",width:"480",height:"360"})}),"\n",(0,r.jsxs)(i.p,{children:["\u8fd9\u91cc\u4ee5 ",(0,r.jsx)(i.strong,{children:"OrangePi-One"})," \u4e3a\u4f8b\uff0c\u4e0b\u9762\u662f\u79fb\u690d\u65f6\u5f00\u53d1\u677f\u7684\u72b6\u6001\uff1a"]}),"\n",(0,r.jsxs)(i.table,{children:[(0,r.jsx)(i.thead,{children:(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.th,{children:"Device"}),(0,r.jsx)(i.th,{children:"OrangePi-One"})]})}),(0,r.jsxs)(i.tbody,{children:[(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:"Arch"}),(0,r.jsx)(i.td,{children:"arm"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:"Distro"}),(0,r.jsx)(i.td,{children:"Armbian 25.5.2"})]}),(0,r.jsxs)(i.tr,{children:[(0,r.jsx)(i.td,{children:"Kernel Version"}),(0,r.jsx)(i.td,{children:"6.12.30-current-sunxi"})]})]})]}),"\n",(0,r.jsx)(i.p,{children:"\u672c\u6587\u5c06\u5206\u4e3a\u4e24\u90e8\u5206\uff0c\u524d\u534a\u90e8\u5206\u4f1a\u4ecb\u7ecd\u5982\u4f55\u5feb\u901f\u90e8\u7f72\u6211\u4eec\u5f00\u53d1\u7684\u793a\u4f8b\u5230\u5f00\u53d1\u677f\u4e0a\uff0c\u540e\u534a\u90e8\u5206\u5219\u662f\u79fb\u690d\u8fc7\u7a0b\u7684\u8be6\u7ec6\u8bf4\u660e\u3002"}),"\n",(0,r.jsx)(i.h2,{id:"\u5feb\u901f\u90e8\u7f72\u793a\u4f8b",children:"\u5feb\u901f\u90e8\u7f72\u793a\u4f8b"}),"\n",(0,r.jsx)(i.p,{children:"\u5148\u62c9\u53d6\u5bf9\u5e94\u4ed3\u5e93\uff0c\u7136\u540e\u6765\u5230\u5f00\u53d1\u677f\u5bf9\u5e94\u7684\u76ee\u5f55\u4e0b\uff1a"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-bash",children:"git clone https://github.com/embeddedboys/pico_dm_yt350s006_linux.git\ncd orangepi-one\n"})}),"\n",(0,r.jsx)(i.p,{children:"\u7f16\u8bd1\u8bbe\u5907\u6811overlay\u4ee5\u53ca\u56fa\u4ef6\uff0c\u5c06\u7f16\u8bd1\u597d\u7684\u6587\u4ef6\u653e\u7f6e\u5230\u6307\u5b9a\u4f4d\u7f6e\uff1a"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-bash",children:"make\n\nsudo cp panel-mipi-dbi.bin /lib/firmware/\nsudo cp sun8i-h3-spi-st7796u-drm.dtbo /boot/dtb/overlays/\n"})}),"\n",(0,r.jsx)(i.p,{children:"\u91cd\u542f\u8bbe\u5907\uff0c\u7136\u540e\u624b\u52a8\u52a0\u8f7d\u9a71\u52a8:"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{children:"sudo reboot\n\nsudo modprobe panel-mipi-dbi\n"})}),"\n",(0,r.jsx)(i.p,{children:"\u5982\u679c\u4e00\u5207\u987a\u5229\uff0c\u5c4f\u5e55\u5df2\u7ecf\u6b63\u5e38\u663e\u793a\u5185\u5bb9\u3002"}),"\n",(0,r.jsx)(i.h3,{id:"\u5f00\u673a\u81ea\u52a8\u52a0\u8f7d",children:"\u5f00\u673a\u81ea\u52a8\u52a0\u8f7d"}),"\n",(0,r.jsx)(i.p,{children:"\u7531\u4e8e\u4e00\u4e9b\u539f\u56e0\uff0c\u5728Armbian\u7cfb\u7edf\u542f\u52a8\u8fc7\u7a0b\u4e2d\uff0cpanel-mipi-dbi \u9a71\u52a8\u88ab\u8fc7\u65e9\u7684\u52a0\u8f7d\u4e86\uff0c\u65e9\u4e8e\u6587\u4ef6\u7cfb\u7edf\u7684\u6302\u8f7d\uff0c\u56e0\u6b64\uff0cpanel-mipi-dbi \u9a71\u52a8\u65e0\u6cd5\u6b63\u5e38\u83b7\u53d6firmware\u6587\u4ef6\uff08\u4e0d\u5728initramfs\u4e2d\uff09\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u5c06firmware\u6587\u4ef6\u6253\u5305\u8fdbinitramfs\u4e2d\uff0c\u4e0b\u9762\u662f\u64cd\u4f5c\u65b9\u6cd5\uff1a"}),"\n",(0,r.jsx)(i.p,{children:"\u5c06initramfs \u6253\u5305\u8fc7\u7a0b\u7684 hook \u811a\u672c\u653e\u7f6e\u5230\u6307\u5b9a\u7684\u4f4d\u7f6e\uff1a"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-bash",children:"sudo cp initramfs-hook-panel-mipi-dbi-fw /etc/initramfs-tools/hooks/\nsudo chmod u+x /etc/initramfs-tools/hooks/initramfs-hook-panel-mipi-dbi-fw\n"})}),"\n",(0,r.jsx)(i.p,{children:"\u89e6\u53d1initramfs\u6253\u5305\u6d41\u7a0b:"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-bash",children:"update-initramfs -u -v\n"})}),"\n",(0,r.jsx)(i.p,{children:"\u68c0\u67e5\u6253\u5305\u540e\u7684\u5185\u5bb9:"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-bash",children:"root@orangepione:~# lsinitramfs /boot/initrd.img-$(uname -r) | grep panel-mipi-dbi-spi.bin\nusr/lib/firmware/panel-mipi-dbi-spi.bin\n"})}),"\n",(0,r.jsx)(i.p,{children:"\u7136\u540e\u91cd\u542f\u8bbe\u5907\uff0c\u4f60\u53ef\u4ee5\u53d1\u73b0\u5728\u9999\u6a59\u6d3e\u7684\u542f\u52a8\u8fc7\u7a0b\u4e2d\uff0c\u5c4f\u5e55\u81ea\u52a8\u70b9\u4eae\u4e86\u3002"}),"\n",(0,r.jsx)(i.h2,{id:"\u79fb\u690d\u8fc7\u7a0b",children:"\u79fb\u690d\u8fc7\u7a0b"}),"\n",(0,r.jsx)(i.p,{children:"\u4e3a\u4ec0\u4e48\u4f7f\u7528 Armbian \u6765\u505a\u6f14\u793a\uff1f"}),"\n",(0,r.jsx)(i.p,{children:"\u8fd9\u662f\u56e0\u4e3a Armbian \u548c Pi OS \u4e00\u6837\u4f7f\u7528\u4e86 DT overlay \u673a\u5236\uff0c\u8fd9\u4f7f\u5f97\u6211\u4eec\u53ef\u4ee5\u4e0d\u7f16\u5199\u4efb\u4f55\u8bbe\u5907\u9a71\u52a8\u4ee3\u7801\uff0c\u4ec5\u9760\u4e00\u4e9b\u8bbe\u5907\u6811 overlay \u6587\u4ef6\uff0c\u5728\u4e0d\u66f4\u6539\u5185\u6838\u4ee3\u7801\u7684\u60c5\u51b5\u4e0b\uff0c\u6ee1\u8db3\u5927\u90e8\u5206\u7684\u9700\u6c42\u3002"}),"\n",(0,r.jsx)(i.h3,{id:"\u5982\u4f55\u7f16\u5199\u5e76\u5e94\u7528\u4e00\u4e2a-dt-overlay-\u6587\u4ef6",children:"\u5982\u4f55\u7f16\u5199\u5e76\u5e94\u7528\u4e00\u4e2a DT overlay \u6587\u4ef6"}),"\n",(0,r.jsxs)(i.p,{children:["\u9996\u5148\u8981\u8bb2\u8bb2\u5982\u4f55\u5728 Armbian \u4e0a\u7f16\u5199\u5e76\u5e94\u7528\u4e00\u4e2a \u8bbe\u5907\u6811 overlay \u6587\u4ef6\uff0c\u8fd9\u91cc\u4ee5\u5b98\u65b9\u7684 one-wire overlay \u6587\u4ef6 ",(0,r.jsx)(i.code,{children:"sun8i-h3-w1-gpio.dts"})," \u4e3a\u4f8b:"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-c",children:'/dts-v1/;\n/plugin/;\n\n/ {\n\tcompatible = "allwinner,sun8i-h3"; \n\n\tfragment@0 {\n\t\t/*\n\t\t * &pio \u662f\u8981\u8986\u76d6\u7684\u8282\u70b9\uff0c\u5728\u672c\u6848\u4f8b\u4e2d\uff0c\u4f60\u53ef\u4ee5\u5728 sunxi-h3-h5.dtsi\n\t\t * \u8fd9\u4e2a\u6587\u4ef6\u4e2d\u627e\u5230\u8be5\u8282\u70b9\u7684\u539f\u578b\u3002\n\t\t */\n\t\ttarget = <&pio>;\n\n\t\t__overlay__ {\n\t\t\t/* \u6dfb\u52a0\u7684 pinctrl \u914d\u7f6e\uff0c\u5c06 PD14 \u8bbe\u7f6e\u6210 GPIO \u8f93\u5165\u6a21\u5f0f*/\n\t\t\tw1_pins: w1_pins {\n\t\t\t\tpins = "PD14";\n\t\t\t\tfunction = "gpio_in";\n\t\t\t};\n\t\t};\n\t};\n\n\tfragment@1 {\n\t\t/* "/" \u8868\u793a\u8981\u64cd\u4f5c\u6839\u8282\u70b9\u4e0b\u7684\u5185\u5bb9 */\n\t\ttarget-path = "/";\n\n\t\t/* \u8981\u4fee\u6539\u7684\u5185\u5bb9\u603b\u662f\u653e\u5728 __overlay__ \u4e2d */\n\t\t__overlay__ {\n\n\t\t\t/*\n\t\t\t * \u8fd9\u91cc\u5c31\u6309\u7167\u8bbe\u5907\u6811\u7684\u8bed\u6cd5\u63cf\u8ff0\u6dfb\u52a0\u9700\u8981\u7684\u8282\u70b9\n\t\t\t * \u5c31\u884c\u4e86\uff0c\u6ca1\u6709\u4ec0\u4e48\u9700\u8981\u7279\u6b8a\u8bf4\u660e\u7684\u5185\u5bb9\u3002\n\t\t\t * \u8fd9\u91cc\u5bf9\u5e94 drivers/w1/masters/w1-gpio.c \u9a71\u52a8\n\t\t\t */\n\t\t\tonewire@0 {\n\t\t\t\tcompatible = "w1-gpio";\n\t\t\t\tpinctrl-names = "default";\n\t\t\t\tpinctrl-0 = <&w1_pins>;\n\t\t\t\tgpios = <&pio 3 14 0>; /* PD14 */\n\t\t\t\tstatus = "okay";\n\t\t\t};\n\t\t};\n\t};\n};\n'})}),"\n",(0,r.jsx)(i.p,{children:"\u5728\u7f16\u5199\u5b8c\u4e0a\u8ff0 overlay \u6587\u4ef6\u4e4b\u540e\uff0c\u4fee\u6539\u542f\u52a8\u914d\u7f6e\u6587\u4ef6\uff1a"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-bash",children:"sudo vim /boot/armbianEnv.txt\n"})}),"\n",(0,r.jsx)(i.p,{children:"\u5728\u6587\u4ef6\u672b\u5c3e\u6dfb\u52a0\u4ee5\u4e0b\u914d\u7f6e:"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-bash",children:"overlays=w1-gpio\n"})}),"\n",(0,r.jsxs)(i.p,{children:["\u8fd9\u91cc\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5982\u679c\u6709\u591a\u4e2aoverlay\uff0c\u9700\u8981\u7528\u7a7a\u683c\u5206\u9694\u5f00\u3002 \u8fd9\u91cc\u4e0d\u9700\u8981",(0,r.jsx)(i.code,{children:"sun8i-h3"}),"\u524d\u7f00\u7684\u539f\u56e0\u662f\uff0c\u914d\u7f6e\u6587\u4ef6\u4e2d\u5df2\u7ecf\u6307\u5b9a\u4e86",(0,r.jsx)(i.code,{children:"overlay_prefix"}),"\u3002"]}),"\n",(0,r.jsx)(i.p,{children:"\u91cd\u542f\u8bbe\u5907\uff0c\u4f60\u53ef\u4ee5\u5728 dmesg \u4e2d\u770b\u5230\uff0coverlay \u6587\u4ef6\u6240\u5bf9\u5e94\u7684\u9a71\u52a8\u5df2\u7ecf\u88ab\u52a0\u8f7d\u4e86"}),"\n",(0,r.jsx)(i.h3,{id:"\u5982\u4f55\u4f7f\u7528-panel-mipi-dbi-\u9a71\u52a8",children:"\u5982\u4f55\u4f7f\u7528 panel-mipi-dbi \u9a71\u52a8"}),"\n",(0,r.jsx)(i.p,{children:"\u6211\u4eec\u5728\u4e0a\u4e00\u8282\u4e86\u89e3\u4e86\u5982\u4f55\u7f16\u5199\u4e00\u4e2a overlay \u6765\u52a0\u8f7d\u6307\u5b9a\u9a71\u52a8\uff0c\u53ef\u662f\u95ee\u9898\u6765\u4e86\uff0c\u5bf9\u4e8e\u4e00\u4e2a\u964c\u751f\u7684\n\u9a71\u52a8\u7a0b\u5e8f\uff0c\u6211\u4eec\u5982\u4f55\u77e5\u9053\u5b83\u9700\u8981\u54ea\u4e9b\u8bbe\u5907\u6811\u914d\u7f6e\u5462\uff1f\u8fd9\u5c31\u9700\u8981\u67e5\u9605\u5185\u6838\u4e2d\u7684 bindings \u6587\u6863\u4e86\u3002"}),"\n",(0,r.jsxs)(i.p,{children:["\u4f60\u53ef\u4ee5\u5728\u5185\u6838\u4ee3\u7801\u7684 ",(0,r.jsx)(i.code,{children:"Documentation/devicetree/bindings"})," \u76ee\u5f55\u4e0b\u627e\u5230\u5927\u90e8\u5206\u9a71\u52a8\u7684\u8bbe\u5907\u6811\u8282\u70b9\u914d\u7f6e\u793a\u4f8b\uff0cpanel-mipi-dbi \u9a71\u52a8\u7684\u793a\u4f8b\u4f4d\u4e8e ",(0,r.jsx)(i.code,{children:"Documentation/devicetree/bindings/display/panel/panel-mipi-dbi-spi.yaml"}),"\uff0c\u9650\u4e8e\u7bc7\u5e45\uff0c\u6211\u53ea\u5728\u4e0b\u9762\u5c55\u793a\u5173\u952e\u7684\u90e8\u5206\uff1a"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-c",children:'    #include <dt-bindings/gpio/gpio.h>\n\n    spi {\n        #address-cells = <1>;\n        #size-cells = <0>;\n\n        display@0{\n            compatible = "sainsmart18", "panel-mipi-dbi-spi";\n            reg = <0>;\n            spi-max-frequency = <40000000>;\n\n            dc-gpios = <&gpio 24 GPIO_ACTIVE_HIGH>;\n            reset-gpios = <&gpio 25 GPIO_ACTIVE_HIGH>;\n            write-only;\n\n            backlight = <&backlight>;\n\n            width-mm = <35>;\n            height-mm = <28>;\n\n            panel-timing {\n                hactive = <160>;\n                vactive = <128>;\n                hback-porch = <0>;\n                vback-porch = <0>;\n                clock-frequency = <0>;\n                hfront-porch = <0>;\n                hsync-len = <0>;\n                vfront-porch = <0>;\n                vsync-len = <0>;\n            };\n        };\n    };\n\n'})}),"\n",(0,r.jsx)(i.p,{children:"\u73b0\u5728\uff0c\u6211\u4eec\u6765\u4eff\u7167\u4e0a\u9762\u7684\u914d\u7f6e\u521b\u5efa overlay\uff0c\u4e0b\u9762\u662f overlay \u6587\u4ef6\u7684\u5185\u5bb9:"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-c",children:'/dts-v1/;\n/plugin/;\n\n/ {\n\tcompatible = "allwinner,sun8i-h3";\n\n\tfragment@0 {\n\t\ttarget = <&pio>;\n\t\t__overlay__ {\n\t\t\ttft_pins: tft_pins {\n\t\t\t\tpins = "PA2", "PA3";\n\t\t\t\tfunction = "gpio_out";\n\t\t\t};\n\t\t};\n\t};\n\n\tfragment@1 {\n\t\ttarget = <&spi0>;\n\t\t__overlay__ {\n\t\t\tstatus = "okay";\n\n\t\t\ttft: st7796u@0 {\n\t\t\t\t#address-cells = <1>;\n\t\t\t\t#size-cells = <1>;\n\n\t\t\t\tpinctrl-names = "default";\n\t\t\t\tpinctrl-0 = <&tft_pins>;\n\n\t\t\t\tcompatible = "panel-mipi-dbi-spi";\n\n\t\t\t\tspi-max-frequency = <100000000>;\n\t\t\t\treg = <0>;\n\n\t\t\t\twidth-mm = <55>;\n\t\t\t\theight-mm = <84>;\n\n\t\t\t\treset-gpios = <&pio 0 2 0>;\n\t\t\t\tdc-gpios = <&pio 0 3 0>;\n\t\t\t\twrite-only;\n\n\t\t\t\tstatus = "okay";\n\n\t\t\t\tpanel-timing {\n\t\t\t\t\thactive = <480>;\n\t\t\t\t\tvactive = <320>;\n\t\t\t\t\thback-porch = <0>;\n\t\t\t\t\tvback-porch = <0>;\n\n\t\t\t\t\tclock-frequency = <0>;\n\t\t\t\t\thfront-porch = <0>;\n\t\t\t\t\thsync-len = <0>;\n\t\t\t\t\tvfront-porch = <0>;\n\t\t\t\t\tvsync-len = <0>;\n\t\t\t\t};\n\t\t\t};\n\t\t};\n\t};\n};\n'})}),"\n",(0,r.jsxs)(i.p,{children:["\u6211\u4eec\u628a\u8fd9\u4e2a\u6587\u4ef6\u4fdd\u5b58\u4e3a ",(0,r.jsx)(i.code,{children:"sun8i-h3-spi-st7796u-drm.dts"}),"\uff0c\u7136\u540e\u7f16\u8bd1\u6210\u4e8c\u8fdb\u5236\uff1a"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-bash",children:"dtc -@ -I dts -O dtb -o sun8i-h3-spi-st7796u-drm.dtbo sun8i-h3-spi-st7796u-drm.dts\n"})}),"\n",(0,r.jsxs)(i.p,{children:["\u8bb2\u8fd9\u4e2a\u6587\u4ef6\u62f7\u8d1d\u5230 ",(0,r.jsx)(i.code,{children:"/boot/dtb/overlay"})," \u6587\u4ef6\u5939\u4e0b\uff0c\u4fee\u6539 ",(0,r.jsx)(i.code,{children:"/boot/armbianEnv.txt"}),"\uff0c\u6dfb\u52a0overlay\u914d\u7f6e\uff1a"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-bash",children:"sudo cp sun8i-h3-spi-st7796u-drm.dtbo /boot/dtb/overlay/\nsudo vim /boot/armbianEnv.txt\n"})}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-bash",children:"overlays=spi-st7796u-drm\n"})}),"\n",(0,r.jsx)(i.p,{children:"\u914d\u7f6e\u5b8c\u6210\u540e\uff0c\u91cd\u542f\u8bbe\u5907\u540e\uff0c\u67e5\u770b\u5185\u6838\u65e5\u5fd7\uff0c\u4f60\u4f1a\u53d1\u73b0\u5982\u4e0b\u62a5\u9519\uff1a"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-c",children:"[    3.350494] panel-mipi-dbi-spi spi0.0: Direct firmware load for panel-mipi-dbi-spi.bin failed with error -2\n[    3.350538] panel-mipi-dbi-spi spi0.0: Falling back to sysfs fallback for: panel-mipi-dbi-spi.bin\n[   64.499684] panel-mipi-dbi-spi spi0.0: No config file found for compatible 'panel-mipi-dbi-spi' (error=-110)\n[   64.499725] panel-mipi-dbi-spi spi0.0: probe with driver panel-mipi-dbi-spi failed with error -110\n"})}),"\n",(0,r.jsx)(i.p,{children:"\u8fd9\u662f\u56e0\u4e3a\u9a71\u52a8\u6ca1\u6709\u627e\u5230\u6709\u6548\u7684 firmware \u6587\u4ef6\uff0c\u4e0b\u9762\u6211\u4eec\u6765\u4ecb\u7ecd\u5982\u4f55\u4e3a panel-mipi-dbi \u9a71\u52a8\u5236\u4f5c firmware\u3002"}),"\n",(0,r.jsxs)(i.p,{children:["\u9996\u5148\uff0c\u4f60\u9700\u8981 ",(0,r.jsx)(i.code,{children:"mipi-dbi-cmd"})," \u8fd9\u4e2a\u5de5\u5177\uff0c\u4f60\u53ef\u4ee5\u5728\u9a71\u52a8\u4f5c\u8005\u7684\u8fd9\u4e2a\u4ed3\u5e93\u4e2d\u627e\u5230 ",(0,r.jsx)(i.a,{href:"https://github.com/notro/panel-mipi-dbi/blob/main/mipi-dbi-cmd",children:"mipi-dbi-cmd"}),"\uff0c\u5b83\u662f\u4e00\u4e2apython\u811a\u672c\uff0c\u628a\u5b83\u4e0b\u8f7d\u5230\u672c\u5730\uff0c\u6dfb\u52a0\u53ef\u6267\u884c\u6743\u9650\u5c31\u53ef\u4ee5\u4e86\u3002"]}),"\n",(0,r.jsxs)(i.p,{children:["\u8fd9\u662f\u4e00\u4e2a firmware \u7684\u6e90\u6587\u4ef6\u793a\u4f8b, ",(0,r.jsx)(i.code,{children:"rpi-dm-hp35006.txt"})," \uff1a"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-c",children:"command 0xF0 0xC3\ncommand 0xF0 0x96\ncommand 0x36 0x28\ncommand 0x3A 0x55\ncommand 0xB4 0x01\ncommand 0xB1 0x80 0x01\ncommand 0xB5 0x1F 0x50 0x00 0x20\ncommand 0xB6 0x8A 0x07 0x3B\ncommand 0xC0 0x80 0x64\ncommand 0xC1 0x13\ncommand 0xC2 0xA7\ncommand 0xC5 0x09\ncommand 0xE8 0x40 0x8a 0x00 0x00 0x29 0x19 0xA5 0x33\ncommand 0xE0 0xF0 0x06 0x0B 0x07 0x06 0x05 0x2E 0x33 0x47 0x3A 0x17 0x16 0x2E 0x31\ncommand 0xE1 0xF0 0x09 0x0D 0x09 0x08 0x23 0x2E 0x33 0x46 0x38 0x13 0x13 0x2C 0x32\ncommand 0xF0 0x3C\ncommand 0xF0 0x69\ncommand 0x35 0x00\ncommand 0x11\ndelay 120\ncommand 0x29\ndelay 50\ncommand 0x21\n"})}),"\n",(0,r.jsxs)(i.p,{children:["\u5bc4\u5b58\u5668\u64cd\u4f5c\u4ee5 ",(0,r.jsx)(i.code,{children:"command"})," \u547d\u4ee4\u5f00\u5934\uff0c\u540e\u9762\u7d27\u8ddf\u7684\u662f\u5bc4\u5b58\u5668\u5730\u5740\uff0c\u5728\u6b64\u4e4b\u540e\u7684\u90fd\u662f\u53c2\u6570"]}),"\n",(0,r.jsxs)(i.p,{children:["\u5ef6\u65f6\u64cd\u4f5c\u4ee5 ",(0,r.jsx)(i.code,{children:"delay"})," \u547d\u4ee4\u5f00\u5934\uff0c\u540e\u9762\u7d27\u8ddf\u7684\u662f\u6beb\u79d2\u6570"]}),"\n",(0,r.jsxs)(i.p,{children:["\u7f16\u5199\u5b8c\u6210\u540e\uff0c\u4f7f\u7528 ",(0,r.jsx)(i.code,{children:"mipi-dbi-cmd"})," \u5de5\u5177\u5c06\u5176\u8f6c\u6210bin\u6587\u4ef6\uff1a"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-bash",children:"./mipi-dbi-cmd panel-mipi-dbi.bin rpi-dm-hp35006.txt\n"})}),"\n",(0,r.jsxs)(i.p,{children:["\u5c06 ",(0,r.jsx)(i.code,{children:"panel-mipi-dbi.bin"})," \u6587\u4ef6\u62f7\u8d1d\u5230 ",(0,r.jsx)(i.code,{children:"/lib/firmware"})," \u6587\u4ef6\u5939\u4e2d\uff0c\u91cd\u65b0\u52a0\u8f7d\u9a71\u52a8\uff0c\u67e5\u770b\u65e5\u5fd7\uff0c\u4f60\u4f1a\u53d1\u73b0\u9a71\u52a8\u5df2\u7ecf\u6210\u529f\u52a0\u8f7d\u4e86\uff1a"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-bash",children:"sudo modprobe panel-mipi-dbi-spi\n"})}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-bash",children:"developer@orangepione:~$ dmesg | grep panel\n[    3.343660] panel-mipi-dbi-spi spi0.0: supply power not found, using dummy regulator\n[    3.344113] panel-mipi-dbi-spi spi0.0: supply io not found, using dummy regulator\n[    3.378360] [drm] Initialized panel-mipi-dbi 1.0.0 for spi0.0 on minor 1\n[    3.868253] panel-mipi-dbi-spi spi0.0: [drm] fb0: panel-mipi-dbid frame buffer device\n"})}),"\n",(0,r.jsx)(i.p,{children:"\u4f46\u662f\u5c4f\u5e55\u4ecd\u7136\u9ed1\u5c4f\uff0c\u8fd9\u662f\u56e0\u4e3a\u6ca1\u6709\u5f00\u542f\u80cc\u5149\u5bfc\u81f4\u7684\uff0c\u73b0\u5728\uff0c\u4f60\u53ef\u4ee5\u901a\u8fc7 gpio sysfs \u624b\u52a8\u64cd\u4f5c\u80cc\u5149\u5f15\u811a\u6765\u70b9\u4eae\u80cc\u5149\uff0c\u672c\u6848\u4f8b\u4e2d\u80cc\u5149\u5f15\u811a\u4e3a PD14 \uff0c\u5bf9\u5e94\u7f16\u53f7 110\uff0c\u5168\u5fd7\u5e73\u53f0\u6bcf32\u4e2agpio\u4e3a\u4e00\u7ec4\uff1a"}),"\n",(0,r.jsx)(i.p,{children:"PD14 = 32 * 3 + 14 = 110"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-bash",children:"echo 110 > /sys/class/gpio/export\necho out > /sys/class/gpio/gpio110/direction\necho 1 > /sys/class/gpio/gpio110/value\n"})}),"\n",(0,r.jsx)(i.p,{children:"\u5728\u6267\u884c\u5b8c\u4e0a\u8ff0\u547d\u4ee4\u540e\uff0c\u80cc\u5149\u88ab\u6fc0\u6d3b\uff0c\u5c4f\u5e55\u663e\u793a\u4e86\u5185\u5bb9\u3002"}),"\n",(0,r.jsx)(i.p,{children:"\u4f46\u662f\u5982\u4f55\u8ba9\u5176\u81ea\u52a8\u5b8c\u6210\u5462\uff1f\u4e3a\u4ec0\u4e48\u524d\u9762\u7684panel-mipi-dbi\u7684\u8bbe\u5907\u6811\u8282\u70b9\u6ca1\u6709\u80cc\u5149\u914d\u7f6e\uff1f\u6211\u4eec\u4f1a\u5728\u4e0b\u4e00\u8282\u63cf\u8ff0\u8fd9\u4e2a\u95ee\u9898\u3002"}),"\n",(0,r.jsx)(i.h3,{id:"\u5c4f\u5e55\u7684\u80cc\u5149\u662f\u4e2a\u5927\u95ee\u9898",children:"\u5c4f\u5e55\u7684\u80cc\u5149\u662f\u4e2a\u5927\u95ee\u9898"}),"\n",(0,r.jsx)(i.p,{children:"\u5728\u4e0a\u4e00\u8282\u4e2d\uff0c\u6211\u4eec\u5df2\u7ecf\u6210\u529f\u9a71\u52a8\u4e86\u5c4f\u5e55\uff0c\u53ef\u662f\u5c4f\u5e55\u8fd8\u662f\u6ca1\u6709\u4eae\uff0c\u8fd9\u662f\u56e0\u4e3a\u6ca1\u6709\u6253\u5f00\u5c4f\u5e55\u7684\u80cc\u5149\uff0c\u90a3\u5982\u4f55\u5728\u5c4f\u5e55\u9a71\u52a8\u52a0\u8f7d\u65f6\u81ea\u52a8\u5f00\u542f\u80cc\u5149\u5462\uff1f"}),"\n",(0,r.jsx)(i.p,{children:"\u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u4f1a\u5728panel-mipi-dbi\u7684\u8bbe\u5907\u6811\u8282\u70b9\u4e2d\u6dfb\u52a0\u8fd9\u4e48\u4e00\u884c\u914d\u7f6e\uff1a"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-c",children:"backlight = <&backlight>;\n"})}),"\n",(0,r.jsxs)(i.p,{children:["\u8fd9\u4e2a ",(0,r.jsx)(i.code,{children:"&backlight"})," \u662f\u5728\u54ea\u4e2a\u8282\u70b9\u4e2d\u5b9a\u4e49\u7684\u5462\uff1f\u5728\u7edd\u5927\u591a\u6570\u5e73\u53f0\u4e0a\uff0c\u53ef\u4ee5\u7b80\u5355\u5730\u8fd9\u4e48\u7f16\u5199\u8bbe\u5907\u6811\u8282\u70b9\uff1a"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-c",children:'backlight {\n\tcompatible = "gpio-backlight";\n\tgpios = <&gpio3 4 GPIO_ACTIVE_HIGH>;\n\tdefault-on;\n};\n'})}),"\n",(0,r.jsx)(i.p,{children:"\u8fd9\u5c06\u628a gpio3 \u7684 4 \u53f7\u5f15\u811a\u4f5c\u4e3a\u80cc\u5149\u7684\u63a7\u5236\u5f15\u811a\uff0c\u4e0d\u8fc7\u529f\u80fd\u8f83\u4e3a\u7b80\u5355\uff0c\u53ea\u80fd\u63a7\u5236\u5f00\u542f\u548c\u5173\u95ed\u3002"}),"\n",(0,r.jsx)(i.p,{children:"\u4e3a\u4ec0\u4e48\u5728 OrangePi-One \u7684 Armbian \u4e0a\u65e0\u6cd5\u4f7f\u7528\uff1f\u6211\u5728\u8fd9\u4e2a\u80cc\u5149\u7684\u9002\u914d\u8fc7\u7a0b\u9047\u5230\u4e86\u5f88\u591a\u95ee\u9898\uff0c\u8ba9\u6211\u4eec\u6765\u9010\u4e2a\u5206\u6790\u3002"}),"\n",(0,r.jsx)(i.h4,{id:"1-\u7cfb\u7edf\u4e2d\u7f3a\u5c11-gpio-backlight-\u9a71\u52a8\u7684-ko-\u6587\u4ef6",children:"1. \u7cfb\u7edf\u4e2d\u7f3a\u5c11 gpio-backlight \u9a71\u52a8\u7684 ko \u6587\u4ef6"}),"\n",(0,r.jsxs)(i.p,{children:["\u5728\u6811\u8393\u6d3e\u4e0a\uff0c\u8fd9\u4e2a\u9a71\u52a8\u4f4d\u4e8e ",(0,r.jsx)(i.code,{children:"/lib/modules/$(uname -r)/kernel/drivers/video/backlight/gpio-backlight.ko"}),"\u3002 \u4f46\u662f\u6211\u6ca1\u6709\u5728 OrangePi-One \u4e0a\u627e\u5230\u8fd9\u4e2a\u9a71\u52a8\u6587\u4ef6\uff0c\u540c\u65f6\u6211\u5c1d\u8bd5\u4e86\u5728 dt overlay \u6587\u4ef6\u4e2d\u8c03\u7528\u8fd9\u4e2a\u9a71\u52a8\uff0c\u6ca1\u6709\u8d77\u6548\uff0c\u8bf4\u660e\u8fd9\u4e2a\u9a71\u52a8\u6ca1\u6709\u88ab\u7f16\u8bd1\u5230\u7cfb\u7edf\u6216\u8005\u5185\u6838\u4e2d\u53bb\u3002"]}),"\n",(0,r.jsx)(i.h4,{id:"2-\u7cfb\u7edf\u4e2d\u6709-pwm-backlight-\u9a71\u52a8\u4f46\u662f-pd14-\u5f15\u811a\u6ca1\u6709-pwm-\u529f\u80fd",children:"2. \u7cfb\u7edf\u4e2d\u6709 pwm-backlight \u9a71\u52a8\uff0c\u4f46\u662f PD14 \u5f15\u811a\u6ca1\u6709 PWM \u529f\u80fd"}),"\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.code,{children:"drivers/pinctrl/sunxi/pinctrl-sun8i-h3.c"})}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-c",children:'static const struct sunxi_desc_pin sun8i_h3_pins[] = {\n\t...\n\tSUNXI_PIN(SUNXI_PINCTRL_PIN(D, 14),\n\t\t  SUNXI_FUNCTION(0x0, "gpio_in"),\n\t\t  SUNXI_FUNCTION(0x1, "gpio_out"),\n\t\t  SUNXI_FUNCTION(0x2, "emac")),\t\t/* TXERR */\n\t...\n};\n'})}),"\n",(0,r.jsx)(i.p,{children:"\u90a3\u4e48\u6700\u540e\u6211\u662f\u5982\u4f55\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u7684\uff1f\u597d\u5427\uff0c\u5982\u4f60\u6240\u89c1\uff0c\u6211\u5c1d\u8bd5\u4e86\u4e00\u4e9b\u65b9\u6cd5\uff0c\u4f46\u662f\u90fd\u4e0d\u80fd\u5b9e\u73b0\u5728\u5c4f\u5e55\u9a71\u52a8\u52a0\u8f7d\u65f6\u81ea\u52a8\u5f00\u542f\u80cc\u5149\u3002"}),"\n",(0,r.jsx)(i.p,{children:"\u6240\u4ee5\u6211\u8c03\u8f6c\u4e86\u601d\u8def\uff0c\u5728\u542f\u52a8\u65f6\uff0c\u9a71\u52a8\u52a0\u8f7d\u524d\u81ea\u52a8\u5c06\u80cc\u5149\u70b9\u4eae\u3002 \u867d\u7136\u4e0d\u591f\u4f18\u96c5\uff0c\u4f46\u662f\u8d77\u7801\u53ef\u4ee5\u6b63\u5e38\u5de5\u4f5c\u3002 \u6211\u5c1d\u8bd5\u4e86\u4e00\u4e9b\u65b9\u6cd5\uff0c\u4f46\u8fd8\u662f\u9047\u5230\u4e86\u4e00\u4e9b\u95ee\u9898\uff0c\u4e0d\u8fc7\u6700\u540e\u8fd8\u662f\u89e3\u51b3\u4e86\uff0c\u4e0b\u9762\u6765\u9010\u4e2a\u5206\u6790\uff1a"}),"\n",(0,r.jsx)(i.h4,{id:"3-gpio-hog-\u914d\u7f6e\u53ef\u4ee5\u8ba9\u67d0\u4e2a\u6307\u5b9a\u5f15\u811a\u5728-gpiochip-\u52a0\u8f7d\u65f6\u8bbe\u7f6e\u4e00\u4e2a\u56fa\u5b9a\u72b6\u6001",children:"3. gpio-hog \u914d\u7f6e\u53ef\u4ee5\u8ba9\u67d0\u4e2a\u6307\u5b9a\u5f15\u811a\u5728 gpiochip \u52a0\u8f7d\u65f6\u8bbe\u7f6e\u4e00\u4e2a\u56fa\u5b9a\u72b6\u6001"}),"\n",(0,r.jsxs)(i.p,{children:["\u67e5\u770b\u5185\u6838\u6587\u6863 ",(0,r.jsx)(i.a,{href:"https://www.kernel.org/doc/Documentation/devicetree/bindings/gpio/gpio.txt",children:"https://www.kernel.org/doc/Documentation/devicetree/bindings/gpio/gpio.txt"})," \u6709\u5982\u4e0b\u5185\u5bb9\uff1a"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-txt",children:'The GPIO chip may contain GPIO hog definitions. GPIO hogging is a mechanism\nproviding automatic GPIO request and configuration as part of the\ngpio-controller\'s driver probe function.\n\nEach GPIO hog definition is represented as a child node of the GPIO controller.\nRequired properties:\n- gpio-hog:   A property specifying that this child node represents a GPIO hog.\n- gpios:      Store the GPIO information (id, flags, ...) for each GPIO to\n\t      affect. Shall contain an integer multiple of the number of cells\n\t      specified in its parent node (GPIO controller node).\nOnly one of the following properties scanned in the order shown below.\nThis means that when multiple properties are present they will be searched\nin the order presented below and the first match is taken as the intended\nconfiguration.\n- input:      A property specifying to set the GPIO direction as input.\n- output-low  A property specifying to set the GPIO direction as output with\n\t      the value low.\n- output-high A property specifying to set the GPIO direction as output with\n\t      the value high.\n\nOptional properties:\n- line-name:  The GPIO label name. If not present the node name is used.\n\nExample of two SOC GPIO banks defined as gpio-controller nodes:\n\n\tqe_pio_a: gpio-controller@1400 {\n\t\tcompatible = "fsl,qe-pario-bank-a", "fsl,qe-pario-bank";\n\t\treg = <0x1400 0x18>;\n\t\tgpio-controller;\n\t\t#gpio-cells = <2>;\n\n\t\tline_b-hog {\n\t\t\tgpio-hog;\n\t\t\tgpios = <6 0>;\n\t\t\toutput-low;\n\t\t\tline-name = "foo-bar-gpio";\n\t\t};\n\t};\n\n\tqe_pio_e: gpio-controller@1460 {\n\t\tcompatible = "fsl,qe-pario-bank-e", "fsl,qe-pario-bank";\n\t\treg = <0x1460 0x18>;\n\t\tgpio-controller;\n\t\t#gpio-cells = <2>;\n\t};\n'})}),"\n",(0,r.jsx)(i.p,{children:"\u6211\u6839\u636e\u6587\u6863\u4e2d\u7684\u793a\u4f8b\u914d\u7f6e\u4e86\u4e00\u4e2ahog\u8282\u70b9\uff1a"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-c",children:'\tfragment@1 {\n\t\ttarget = <&pio>;\n\t\t__overlay__ {\n\t\t\tbl_hog {\n\t\t\t\tgpio-hog;\n\t\t\t\tgpios = <&pio 3 14 0>;\n\t\t\t\toutput-high;\n\t\t\t\tline-name = "display-backlight";\n\t\t\t};\n\t\t};\n\t};\n'})}),"\n",(0,r.jsxs)(i.p,{children:["\u4f46\u8fd9\u6ca1\u6709\u6548\u679c\uff0c\u91cd\u542f\u540e\u6211\u6ca1\u6709\u5728\u5185\u6838\u65e5\u5fd7\u4e2d\u770b\u5230\u4efb\u4f55\u4e0ehog\u76f8\u5173\u7684\u5185\u5bb9\uff0c\u7ffb\u9605\u6e90\u7801\uff0c\u6709\u5173\ngpio-hog \u7684\u5904\u7406\u4f4d\u4e8e ",(0,r.jsx)(i.code,{children:"of_gpiochip_scan_gpios"})," \u51fd\u6570\u4e2d ",(0,r.jsx)(i.code,{children:"drivers/gpio/gpiolib-of.c"}),"\uff0c\n\u5982\u679cgpio-hog\u88ab\u6210\u529f\u914d\u7f6e\uff0c\u90a3\u4e48\u5728",(0,r.jsx)(i.code,{children:"drivers/gpio/gpiolib.c#L4182"})," \u6709\u5982\u4e0b\u65e5\u5fd7\u903b\u8f91\uff1a"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-c",children:'int gpiod_hog(struct gpio_desc *desc, const char *name,\n\t      unsigned long lflags, enum gpiod_flags dflags)\n{\n\t...\n\tgpiod_info(desc, "hogged as %s%s\\n",\n\t\t(dflags & GPIOD_FLAGS_BIT_DIR_OUT) ? "output" : "input",\n\t\t(dflags & GPIOD_FLAGS_BIT_DIR_OUT) ?\n\t\t  (dflags & GPIOD_FLAGS_BIT_DIR_VAL) ? "/high" : "/low" : "");\n\t...\n}\n'})}),"\n",(0,r.jsx)(i.p,{children:"\u6211google\u4e86\u76f8\u5173\u95ee\u9898\uff0c\u8fd8\u6709\u4e86\u4e9b\u610f\u5916\u6536\u83b7\uff0c\u6811\u8393\u6d3e\u7684pinctrl\u9a71\u52a8\u5728\u65e9\u671f\u7248\u672c\u56e0\u4e3apinctrl\u548cgpiochip\u6ce8\u518c\u987a\u5e8f\u95ee\u9898\u5bfc\u81f4\u4e86 gpio-hog \u6ca1\u6709\u88ab\u6b63\u5e38\u5904\u7406\uff0c\u53ef\u4ee5\u5230\u5982\u4e0b\u6811\u8393\u6d3e\u8bba\u575b\u67e5\u770b\u539f\u8d34\u5185\u5bb9"}),"\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.a,{href:"https://forums.raspberrypi.com/viewtopic.php?t=260600",children:"https://forums.raspberrypi.com/viewtopic.php?t=260600"})}),"\n",(0,r.jsx)(i.p,{children:"\u4ee5\u53ca\u76f8\u5173\u7684PR\uff1a"}),"\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.a,{href:"https://github.com/raspberrypi/linux/pull/3394",children:"https://github.com/raspberrypi/linux/pull/3394"})}),"\n",(0,r.jsx)(i.p,{children:"\u4fee\u6539\u5185\u5bb9\u5927\u81f4\u4e0a\u662f\u5c06 pinctrl \u9a71\u52a8\u7684\u6ce8\u518c\u653e\u5230\u4e86 gpiochip \u4e4b\u524d\uff0c\u4ea7\u751f\u8fd9\u79cd\u95ee\u9898\u7684\u539f\u56e0\u4e3b\u8981\u662f\u73b0\u5728\u5927\u90e8\u5206\u5904\u7406\u5668\u7684pinctrl\u9a71\u52a8\u90fd\u662f\u5c06 pinctrl \u548c gpiochip \u9a71\u52a8\u6df7\u5408\u5728\u4e00\u8d77\u7f16\u5199\u3002"}),"\n",(0,r.jsx)(i.p,{children:"\u6240\u4ee5\u6211\u67e5\u770b\u4e86\u5168\u5fd7\u5e73\u53f0\u7684 pinctrl \u9a71\u52a8\uff0c\u53d1\u73b0\u5b83\u5e76\u6ca1\u6709\u8fd9\u4e2a\u6ce8\u518c\u987a\u5e8f\u95ee\u9898\uff0c\u6211\u4e0d\u77e5\u6240\u63aa\u4e86\uff1a"}),"\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.code,{children:"drivers/pinctrl/sunxi/pinctrl-sunxi.c"})}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-c",children:'int sunxi_pinctrl_init_with_variant(struct platform_device *pdev,\n\t\t\t\t    const struct sunxi_pinctrl_desc *desc,\n\t\t\t\t    unsigned long variant)\n{\n\t...\n\n\tpctl->pctl_dev = devm_pinctrl_register(&pdev->dev, pctrl_desc, pctl);\n\tif (IS_ERR(pctl->pctl_dev)) {\n\t\tdev_err(&pdev->dev, "couldn\'t register pinctrl driver\\n");\n\t\treturn PTR_ERR(pctl->pctl_dev);\n\t}\n\n\tpctl->chip = devm_kzalloc(&pdev->dev, sizeof(*pctl->chip), GFP_KERNEL);\n\tif (!pctl->chip)\n\t\treturn -ENOMEM;\n\n\tlast_pin = pctl->desc->pins[pctl->desc->npins - 1].pin.number;\n\tpctl->chip->owner = THIS_MODULE;\n\tpctl->chip->request = gpiochip_generic_request;\n\tpctl->chip->free = gpiochip_generic_free;\n\tpctl->chip->set_config = gpiochip_generic_config;\n\tpctl->chip->direction_input = sunxi_pinctrl_gpio_direction_input;\n\tpctl->chip->direction_output = sunxi_pinctrl_gpio_direction_output;\n\tpctl->chip->get = sunxi_pinctrl_gpio_get;\n\tpctl->chip->set = sunxi_pinctrl_gpio_set;\n\tpctl->chip->of_xlate = sunxi_pinctrl_gpio_of_xlate;\n\tpctl->chip->to_irq = sunxi_pinctrl_gpio_to_irq;\n\tpctl->chip->of_gpio_n_cells = 3;\n\tpctl->chip->can_sleep = false;\n\tpctl->chip->ngpio = round_up(last_pin, PINS_PER_BANK) -\n\t\t\t    pctl->desc->pin_base;\n\tpctl->chip->label = dev_name(&pdev->dev);\n\tpctl->chip->parent = &pdev->dev;\n\tpctl->chip->base = pctl->desc->pin_base;\n\n\tret = gpiochip_add_data(pctl->chip, pctl);\n\tif (ret)\n\t\treturn ret;\n\n\tfor (i = 0; i < pctl->desc->npins; i++) {\n\t\tconst struct sunxi_desc_pin *pin = pctl->desc->pins + i;\n\n\t\tret = gpiochip_add_pin_range(pctl->chip, dev_name(&pdev->dev),\n\t\t\t\t\t     pin->pin.number - pctl->desc->pin_base,\n\t\t\t\t\t     pin->pin.number, 1);\n\t\tif (ret)\n\t\t\tgoto gpiochip_error;\n\t}\n\n\t...\n}\n'})}),"\n",(0,r.jsxs)(i.p,{children:["\u6211\u4e0d\u77e5\u9053\u8fd9\u662f\u4e0d\u662f\u7531\u4e8e\u7f3a\u5c11\u4e86 ",(0,r.jsx)(i.code,{children:"pinctrl_add_gpio_range"})," \u8c03\u7528\u7684\u7f18\u6545\uff0c\u4f60\u53ef\u4ee5\u770b\u5230\u6811\u8393\u6d3e\u7684 pinctrl \u9a71\u52a8\uff08",(0,r.jsx)(i.code,{children:"drivers/pinctrl/bcm/pinctrl-bcm2835.c"}),"\uff09\u8fd9\u4e48\u505a\u4e86\uff0c\u5168\u5fd7\u7684 pinctrl \u9a71\u52a8\u5219\u4f7f\u7528\u4e86 ",(0,r.jsx)(i.code,{children:"gpiochip_add_pin_range"}),"\u3002"]}),"\n",(0,r.jsxs)(i.p,{children:["\u603b\u4e4b\u6211\u6ca1\u6709\u8ba9 ",(0,r.jsx)(i.code,{children:"gpio-hog"})," \u5728\u8fd9\u4e2a\u5e73\u53f0\u4e0a\u6210\u529f\u542f\u7528\uff0c\u6211\u4e0d\u662f pinctrl \u4e0e gpio \u9a71\u52a8\u7684\u4e13\u5bb6\uff0c\u4e14\u7531\u4e8e\u4fee\u6539\u5185\u6838\u4ee3\u7801\u4e0d\u662f\u5f88\u65b9\u4fbf\uff0c\u4f60\u9700\u8981\u62c9\u53d6 armbian \u7684 build \u4ed3\u5e93\u6784\u5efa\uff0c\u64cd\u4f5c\u8d77\u6765\u7c7b\u4f3c\u4e8ebuildroot\u3002"]}),"\n",(0,r.jsx)(i.p,{children:"\u6211\u76f8\u4fe1\u8fd9\u4e2a\u95ee\u9898\u80af\u5b9a\u80fd\u591f\u89e3\u51b3\uff0c\u53ef\u80fd\u4f1a\u4ea7\u751f\u65b0\u7684patch\u3002\u4e0d\u8fc7\u6211\u6682\u65f6\u6ca1\u6709\u592a\u591a\u7cbe\u529b\u80fd\u653e\u5728\u8fd9\u4e0a\u9762\uff0c\u6240\u4ee5\u6211\u4e5f\u5c31\u6ca1\u6709\u7ee7\u7eed\u7814\u7a76\u4e0b\u53bb\u4e86\u3002"}),"\n",(0,r.jsx)(i.h4,{id:"4-\u53d6\u5de7\u7684\u65b9\u6cd5\u901a\u8fc7-gpio-leds-\u9a71\u52a8\u70b9\u4eae\u80cc\u5149",children:"4. \u53d6\u5de7\u7684\u65b9\u6cd5\uff0c\u901a\u8fc7 gpio-leds \u9a71\u52a8\u70b9\u4eae\u80cc\u5149"}),"\n",(0,r.jsx)(i.p,{children:"\u6211\u5728\u7ffb\u770b OrangePi-One \u7684\u8bbe\u5907\u6811\u6587\u4ef6\u65f6\uff0c\u53d1\u73b0\u4e86\u4e00\u4e9b\u72b6\u6001\u706f\u7684\u914d\u7f6e\uff1a"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-c",children:'\tleds {\n\t\tcompatible = "gpio-leds";\n\n\t\tpwr_led {\n\t\t\tlabel = "orangepi:green:pwr";\n\t\t\tgpios = <&r_pio 0 10 GPIO_ACTIVE_HIGH>;\n\t\t\tdefault-state = "on";\n\t\t};\n\n\t\tstatus_led {\n\t\t\tlabel = "orangepi:red:status";\n\t\t\tgpios = <&pio 0 15 GPIO_ACTIVE_HIGH>;\n\t\t};\n\t};\n'})}),"\n",(0,r.jsxs)(i.p,{children:["\u8fd9\u4e2a ",(0,r.jsx)(i.code,{children:"pwr_led"})," \u4f4d\u4e8e OrangePi-One \u6b63\u9762\u7684 gpio \u63a5\u53e3\u65c1\uff0c\u7eff\u8272\u706f\u5149\uff0c\u9274\u4e8e\u5b83\u8fde\u63a5\u5230\u4e86\u67d0\u4e2agpio\u5f15\u811a\uff0c\u6240\u4ee5\u5b83\u662f\u6b63\u5e38\u5de5\u4f5c\u7684\u3002 \u4f46\u662f\u6211\u6ca1\u6709\u5728 ",(0,r.jsx)(i.code,{children:"/lib/modules/$(uname -r)/kernel/drivers/leds"})," \u4e0b\u627e\u5230\u8fd9\u4e2a\u9a71\u52a8\uff0c\u8fd9\u8bf4\u660e\u5b83\u88ab\u7f16\u8bd1\u8fdb\u4e86\u5185\u6838\u4e2d\u3002"]}),"\n",(0,r.jsx)(i.p,{children:"\u6240\u4ee5\u6211\u4eff\u7167\u5b83\u7f16\u5199\u4e86\u4e00\u4e2a\u80cc\u5149\u706f\u914d\u7f6e\u8282\u70b9\uff0c\u7ed3\u679c\u5f88\u6210\u529f\u3002 \u4e0d\u8fc7\u5c4f\u5e55\u80cc\u5149\u88ab\u8fc7\u65e9\u5730\u5f00\u542f\u4e86\u3002"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-c",children:'\tfragment@0 {\n\t\ttarget-path = "/";\n\t\t__overlay__ {\n\t\t\tbl_leds {\n\t\t\t\tcompatible = "gpio-leds";\n\n\t\t\t\tpinctrl-names = "default";\n\t\t\t\tpinctrl-0 = <&bl_pins>;\n\n\t\t\t\tbl_led0 {\n\t\t\t\t\tlabel = "display:backlight";\n\t\t\t\t\tgpios = <&pio 3 14 0>;\n\t\t\t\t\tdefault-state = "on";\n\t\t\t\t};\n\t\t\t};\n\t\t};\n\t};\n'})}),"\n",(0,r.jsx)(i.h3,{id:"\u8ba9\u89e6\u6478\u5c4f\u5de5\u4f5c\u8d77\u6765",children:"\u8ba9\u89e6\u6478\u5c4f\u5de5\u4f5c\u8d77\u6765"}),"\n",(0,r.jsx)(i.p,{children:"Still under development"}),"\n",(0,r.jsx)(i.h2,{id:"\u53c2\u8003\u8d44\u6599",children:"\u53c2\u8003\u8d44\u6599"}),"\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.a,{href:"https://github.com/notro/panel-mipi-dbi/wiki",children:"https://github.com/notro/panel-mipi-dbi/wiki"})}),"\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.a,{href:"https://github.com/armbian/sunxi-DT-overlays/blob/master/sun8i-h3/sun8i-h3-w1-gpio.dts",children:"https://github.com/armbian/sunxi-DT-overlays/blob/master/sun8i-h3/sun8i-h3-w1-gpio.dts"})}),"\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.a,{href:"https://elixir.bootlin.com/linux/v6.1.99/source/arch/arm/boot/dts/sun8i-h3-orangepi-one.dts",children:"https://elixir.bootlin.com/linux/v6.1.99/source/arch/arm/boot/dts/sun8i-h3-orangepi-one.dts"}),"\n",(0,r.jsx)(i.a,{href:"https://elixir.bootlin.com/linux/v6.1.99/source/drivers/gpu/drm/drm_mipi_dbi.c",children:"https://elixir.bootlin.com/linux/v6.1.99/source/drivers/gpu/drm/drm_mipi_dbi.c"}),"\n",(0,r.jsx)(i.a,{href:"https://elixir.bootlin.com/linux/v6.1.99/source/drivers/gpu/drm/tiny/panel-mipi-dbi.c",children:"https://elixir.bootlin.com/linux/v6.1.99/source/drivers/gpu/drm/tiny/panel-mipi-dbi.c"}),"\n",(0,r.jsx)(i.a,{href:"https://elixir.bootlin.com/linux/v6.1.99/source/drivers/pinctrl/sunxi/pinctrl-sunxi.c",children:"https://elixir.bootlin.com/linux/v6.1.99/source/drivers/pinctrl/sunxi/pinctrl-sunxi.c"}),"\n",(0,r.jsx)(i.a,{href:"https://elixir.bootlin.com/linux/v6.1.99/source/drivers/gpio/gpiolib-of.c",children:"https://elixir.bootlin.com/linux/v6.1.99/source/drivers/gpio/gpiolib-of.c"}),"\n",(0,r.jsx)(i.a,{href:"https://elixir.bootlin.com/linux/v6.1.99/source/drivers/gpio/gpiolib.c#L4182",children:"https://elixir.bootlin.com/linux/v6.1.99/source/drivers/gpio/gpiolib.c#L4182"})]}),"\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.a,{href:"https://www.kernel.org/doc/Documentation/devicetree/bindings/gpio/gpio.txt",children:"https://www.kernel.org/doc/Documentation/devicetree/bindings/gpio/gpio.txt"})}),"\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.a,{href:"https://forums.raspberrypi.com/viewtopic.php?t=260600",children:"Problem with gpio-hog"})}),"\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.a,{href:"https://github.com/raspberrypi/linux/pull/3394",children:"pinctrl: bcm2835: Change init order for gpio hogs"})})]})}function a(n={}){const{wrapper:i}={...(0,s.R)(),...n.components};return i?(0,r.jsx)(i,{...n,children:(0,r.jsx)(d,{...n})}):d(n)}},7578:(n,i,t)=>{t.d(i,{A:()=>e});const e=t.p+"assets/images/rpi-dm-on-orangepi-one-a1340f1246f9ba0b3884e86270b6f93f.jpg"},8453:(n,i,t)=>{t.d(i,{R:()=>l,x:()=>p});var e=t(6540);const r={},s=e.createContext(r);function l(n){const i=e.useContext(s);return e.useMemo((function(){return"function"==typeof n?n(i):{...i,...n}}),[i,n])}function p(n){let i;return i=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:l(n.components),e.createElement(s.Provider,{value:i},n.children)}}}]);